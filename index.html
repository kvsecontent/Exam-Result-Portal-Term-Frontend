<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Results Portal</title>
    <style>
        /* Core styles only, minimal CSS */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border: 2px solid #3f51b5;
        }

        .header {
            background: #3f51b5;
            color: white;
            padding: 15px;
            text-align: center;
        }

        .search-section {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        input, button {
            padding: 10px;
            margin: 5px;
        }

        button {
            background: #3f51b5;
            color: white;
            border: none;
            cursor: pointer;
        }

        .result-card {
            display: none;
            padding: 15px;
        }

        /* Very basic table styles that work everywhere */
        table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid black;
            margin: 20px 0;
        }

        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
        }

        .error-message {
            color: red;
            text-align: center;
            padding: 15px;
            display: none;
        }

        .debug-section {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Exam Results Portal</h1>
        </div>
        
        <div class="search-section">
            <input type="text" id="rollNumber" placeholder="Enter 5 Digits Admission No.">
            <button onclick="fetchResult()">Get Result</button>
            <button onclick="toggleDebug()" style="background: #666;">Toggle Debug Info</button>
        </div>
        
        <div class="error-message" id="errorMessage">
            Student record not found. Please check the Enrollment number and try again.
        </div>
        
        <div class="debug-section" id="debugSection">
            <h3>Debug Information</h3>
            <div id="debugInfo"></div>
        </div>
        
        <div class="result-card" id="resultCard">
            <h2 id="schoolName">School Name</h2>
            <p>Student: <span id="studentName">John Doe</span></p>
            <p>Roll No: <span id="studentRoll">12345</span></p>
            <p>Class: <span id="studentClass">X-A</span></p>
            
            <!-- Using a very simple HTML table structure -->
            <table id="marksTable">
                <thead>
                    <tr>
                        <th style="width: 40%;">Subject</th>
                        <th style="width: 20%;">Max Marks</th>
                        <th style="width: 20%;">Marks Obtained</th>
                        <th style="width: 20%;">Grade</th>
                    </tr>
                </thead>
                <tbody id="marksTableBody">
                    <!-- Will be filled with JavaScript -->
                </tbody>
            </table>
            
            <div>
                <p><strong>Total:</strong> <span id="totalObtained">0</span>/<span id="totalMax">0</span></p>
                <p><strong>Percentage:</strong> <span id="percentage">0</span>%</p>
                <p><strong>Result:</strong> <span id="resultStatus">PASS</span></p>
            </div>
        </div>
    </div>

    <script>
        // API URL 
        const API_BASE_URL = 'https://term-exam-result-api.onrender.com';
        
        // Debug functions
        function addDebug(message) {
            const debugDiv = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            debugDiv.innerHTML += `<p><strong>${timestamp}:</strong> ${message}</p>`;
            console.log(message);
        }
        
        function toggleDebug() {
            const debugSection = document.getElementById('debugSection');
            debugSection.style.display = debugSection.style.display === 'none' ? 'block' : 'none';
        }
        
        function debugObject(label, obj) {
            addDebug(`${label}: ${JSON.stringify(obj)}`);
        }
        
        // Main functions
        async function fetchDataFromBackend(rollNumber) {
            try {
                addDebug(`Fetching data for roll number: ${rollNumber}`);
                const url = `${API_BASE_URL}/api/student/${rollNumber}`;
                addDebug(`API URL: ${url}`);
                
                const response = await fetch(url);
                const result = await response.json();
                
                if (result.success) {
                    addDebug("API returned success: true");
                    debugObject("API data", result.data);
                    return result.data;
                }
                
                addDebug("API returned success: false");
                return null;
            } catch (error) {
                addDebug(`Error fetching data: ${error.message}`);
                return null;
            }
        }
        
        function displayResult(data, rollNumber) {
            // Set basic info
            document.getElementById('studentName').textContent = data.name;
            document.getElementById('studentRoll').textContent = rollNumber;
            document.getElementById('studentClass').textContent = data.class;
            document.getElementById('schoolName').textContent = data.school || 'Exam Results';
            
            // Set summary information
            document.getElementById('totalObtained').textContent = data.totalObtained;
            document.getElementById('totalMax').textContent = data.totalMarks;
            document.getElementById('percentage').textContent = data.percentage;
            document.getElementById('resultStatus').textContent = data.result;
            
            // Get the table body to fill with marks
            const tableBody = document.getElementById('marksTableBody');
            
            addDebug("Clearing existing table rows");
            tableBody.innerHTML = '';
            
            if (!data.subjects || !Array.isArray(data.subjects)) {
                addDebug("ERROR: subjects is not an array!");
                return;
            }
            
            addDebug(`Populating table with ${data.subjects.length} subjects`);
            
            // Simple HTML string approach
            let tableHTML = '';
            
            data.subjects.forEach((subject, index) => {
                addDebug(`Processing subject ${index+1}: ${subject.name}`);
                
                // Create the table row HTML directly
                tableHTML += `
                    <tr>
                        <td style="text-align: center; width: 40%;">${subject.name}</td>
                        <td style="text-align: center; width: 20%;">${subject.maxMarks || 100}</td>
                        <td style="text-align: center; width: 20%;">${subject.obtained || 0}</td>
                        <td style="text-align: center; width: 20%;">${subject.grade || '-'}</td>
                    </tr>
                `;
            });
            
            // Set the table HTML
            tableBody.innerHTML = tableHTML;
            
            addDebug("Table population complete");
            addDebug(`Final table HTML: ${tableBody.innerHTML}`);
        }
        
        async function fetchResult() {
            // Get the roll number
            const rollNumber = document.getElementById('rollNumber').value.trim();
            const resultCard = document.getElementById('resultCard');
            const errorMessage = document.getElementById('errorMessage');
            
            // Reset displays
            resultCard.style.display = 'none';
            errorMessage.style.display = 'none';
            document.getElementById('debugInfo').innerHTML = '';
            
            // Simple validation
            if (!rollNumber) {
                errorMessage.textContent = "Please enter an admission number";
                errorMessage.style.display = 'block';
                return;
            }
            
            addDebug(`Starting fetch for roll number: ${rollNumber}`);
            
            // Fetch data
            const data = await fetchDataFromBackend(rollNumber);
            
            if (data) {
                displayResult(data, rollNumber);
                resultCard.style.display = 'block';
                addDebug("Successfully displayed result");
            } else {
                errorMessage.style.display = 'block';
                addDebug("No data found or error occurred");
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            addDebug("Page loaded. Application ready.");
            document.getElementById('debugSection').style.display = 'none';
            
            // Add Enter key support
            document.getElementById('rollNumber').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    fetchResult();
                }
            });
        });
    </script>
</body>
</html>
